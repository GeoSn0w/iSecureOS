//
//  iSecureOS-Anti-Malware.m
//  iSecureOS
//
//  Created by GeoSn0w on 3/24/21.
//

#import "iSecureOS-Anti-Malware.h"
#import <AWFileHash.h>

@interface iSecureOS_Anti_Malware ()

@end

@implementation iSecureOS_Anti_Malware
NSMutableArray *definitions;
NSMutableArray *detectedMalware;

- (void)viewDidLoad {
    [super viewDidLoad];
    _removeFileButton.layer.cornerRadius = 22;
    _removeFileButton.clipsToBounds = YES;
}

- (IBAction)removeFileAct:(id)sender {
}

- (IBAction)keepFileAct:(id)sender {
}

-(int) scanForMalwareAtPath{
    NSFileManager *fileManager = [NSFileManager defaultManager];
    NSURL *directoryURL = [NSURL URLWithString:@"/Library/MobileSubstrate/DynamicLibraries/"];
    NSArray *keys = [NSArray arrayWithObject:NSURLIsDirectoryKey];

    NSDirectoryEnumerator *enumerator = [fileManager
        enumeratorAtURL:directoryURL
        includingPropertiesForKeys:keys
        options:0
        errorHandler:^BOOL(NSURL *url, NSError *error) {
            printf("Something went wrong and the path could not be accessed.\n");
            return YES;
    }];

    for (NSURL *url in enumerator) {
        NSError *error;
        NSNumber *isDirectory = nil;
        if (![url getResourceValue:&isDirectory forKey:NSURLIsDirectoryKey error:&error]) {
            printf("Could not scan path. It's a directoy.\n");
        }
        else if (![isDirectory boolValue]) {
            NSString *filetocheckpath = url.absoluteString;
            NSString *hashsignature = [AWFileHash sha1HashOfFileAtPath:filetocheckpath];
            if ([definitions containsObject:hashsignature]){
                [detectedMalware addObject:url];
                
            }
        }
    }
    
    
    return 0;
    
}

@end
